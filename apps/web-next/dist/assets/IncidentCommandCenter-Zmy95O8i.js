import{r as o,j as e,a as i}from"./index-DPSUG5BZ.js";const m={sev1:"text-rose-400",sev2:"text-orange-400",sev3:"text-amber-400",sev4:"text-blue-400"},x={sev1:"bg-rose-500/20 text-rose-300 border border-rose-500/40",sev2:"bg-orange-500/20 text-orange-300 border border-orange-500/40",sev3:"bg-amber-500/20 text-amber-300 border border-amber-500/40",sev4:"bg-blue-500/20 text-blue-300 border border-blue-500/40"},f={sev1:"SEV1 â€” Critical",sev2:"SEV2 â€” Major",sev3:"SEV3 â€” Minor",sev4:"SEV4 â€” Informational"},u={triggered:"bg-rose-500/20 text-rose-300 border border-rose-500/30",acknowledged:"bg-blue-500/20 text-blue-300 border border-blue-500/30",investigating:"bg-amber-500/20 text-amber-300 border border-amber-500/30",mitigated:"bg-indigo-500/20 text-indigo-300 border border-indigo-500/30",resolved:"bg-emerald-500/20 text-emerald-300 border border-emerald-500/30"},p={comment:"ðŸ’¬",status_change:"ðŸ”„",runbook:"ðŸ“‹",escalation:"ðŸ“£",page:"ðŸ“Ÿ",mitigation:"ðŸ› ï¸",resolution:"âœ…",alert:"ðŸ””"},l=[{id:"INC-4821",title:"API Gateway 5xx spike â€” auth service degraded",severity:"sev1",status:"investigating",service:"auth-service",owner:"tim@clawdbot.io",startedAt:"2026-02-22T09:47:00Z",resolvedAt:null,durationMin:null,affectedUsers:18240,slackChannel:"#inc-4821",runbook:"https://runbooks.internal/auth-service-degraded",impactDescription:"Authentication failures for ~18k active users. Login and token refresh failing with 502 errors. API Gateway returning 5xx for ~23% of auth requests.",rootCause:null,responders:[{id:"r1",name:"Tim",role:"Incident Commander",joinedAt:"09:48",active:!0},{id:"r2",name:"Xavier",role:"Technical Lead",joinedAt:"09:49",active:!0},{id:"r3",name:"Sam",role:"Auth Specialist",joinedAt:"09:51",active:!0},{id:"r4",name:"Quinn",role:"Observability",joinedAt:"09:52",active:!0}],timeline:[{id:"t1",type:"alert",author:"PagerDuty",timestamp:"09:47:12",content:"Alert triggered: auth_error_rate > 20% for 3m",metadata:"alert:auth-high-error-rate"},{id:"t2",type:"page",author:"System",timestamp:"09:47:15",content:"On-call paged: Tim, Sam",metadata:null},{id:"t3",type:"status_change",author:"Tim",timestamp:"09:48:03",content:"Status changed to Acknowledged",metadata:null},{id:"t4",type:"comment",author:"Tim",timestamp:"09:49:22",content:"Taking IC. Pulling up auth-service metrics. Looks like memory spiked ~5 min ago.",metadata:null},{id:"t5",type:"escalation",author:"Tim",timestamp:"09:50:00",content:"Escalating to Xavier as TL. Auth service may need restart.",metadata:null},{id:"t6",type:"status_change",author:"Tim",timestamp:"09:51:30",content:"Status changed to Investigating",metadata:null},{id:"t7",type:"runbook",author:"Sam",timestamp:"09:52:00",content:"Following runbook: auth-service-degraded. Checking pod health in k8s.",metadata:"Step 3: Check pod readiness probes"},{id:"t8",type:"comment",author:"Quinn",timestamp:"09:54:12",content:"Memory at 97% on auth-service-pod-2 and auth-service-pod-3. OOMkill likely.",metadata:null},{id:"t9",type:"comment",author:"Sam",timestamp:"09:56:30",content:"Rolling restart initiated on affected pods. Traffic draining.",metadata:null}]},{id:"INC-4819",title:"Report generation service timeout â€” async queue backed up",severity:"sev2",status:"mitigated",service:"report-service",owner:"xavier@clawdbot.io",startedAt:"2026-02-22T07:15:00Z",resolvedAt:null,durationMin:157,affectedUsers:842,slackChannel:"#inc-4819",runbook:"https://runbooks.internal/report-service-timeout",impactDescription:"Report generation requests timing out after 30s. ~842 users unable to export reports. Queue depth at 4,200+ jobs.",rootCause:"Deadlock in report DB connection pool caused by a query that held a long-running transaction during a schema migration.",responders:[{id:"r1",name:"Xavier",role:"Incident Commander",joinedAt:"07:16",active:!0},{id:"r2",name:"Tim",role:"Database Lead",joinedAt:"07:18",active:!1}],timeline:[{id:"t1",type:"alert",author:"PagerDuty",timestamp:"07:15:00",content:"Alert: report_generation_p95 > 25s for 5m"},{id:"t2",type:"status_change",author:"Xavier",timestamp:"07:16:12",content:"Acknowledged"},{id:"t3",type:"status_change",author:"Xavier",timestamp:"07:22:00",content:"Investigating"},{id:"t4",type:"comment",author:"Tim",timestamp:"07:35:00",content:"Found deadlock in pg_stat_activity. Killing stuck query."},{id:"t5",type:"mitigation",author:"Xavier",timestamp:"07:52:00",content:"Mitigated: DB connection pool recycled, queue processing resumed. Monitoring."},{id:"t6",type:"status_change",author:"Xavier",timestamp:"07:52:00",content:"Status changed to Mitigated"}]},{id:"INC-4815",title:"Webhook delivery failures â€” TLS cert expiry",severity:"sev2",status:"resolved",service:"webhook-service",owner:"sam@clawdbot.io",startedAt:"2026-02-21T14:00:00Z",resolvedAt:"2026-02-21T16:45:00Z",durationMin:165,affectedUsers:2140,slackChannel:"#inc-4815",runbook:"https://runbooks.internal/webhook-tls-renewal",impactDescription:"Webhook deliveries failing for ~2,140 endpoints due to TLS handshake errors. Certificate expired at 14:00 UTC.",rootCause:"Auto-renewal cron job failed silently 30 days prior due to misconfigured credentials. Certificate expired without replacement.",responders:[{id:"r1",name:"Sam",role:"Incident Commander",joinedAt:"14:02",active:!1},{id:"r2",name:"Tim",role:"Infrastructure",joinedAt:"14:10",active:!1}],timeline:[{id:"t1",type:"alert",author:"PagerDuty",timestamp:"14:00:02",content:"Alert: webhook_delivery_error_rate > 90%"},{id:"t2",type:"status_change",author:"Sam",timestamp:"14:03:00",content:"Acknowledged"},{id:"t3",type:"comment",author:"Tim",timestamp:"14:22:00",content:"TLS cert expired. Issuing emergency renewal via certbot."},{id:"t4",type:"mitigation",author:"Tim",timestamp:"15:10:00",content:"New cert deployed. Deliveries resuming."},{id:"t5",type:"resolution",author:"Sam",timestamp:"16:45:00",content:"Queue drained, error rate at 0%. Resolved."},{id:"t6",type:"status_change",author:"Sam",timestamp:"16:45:00",content:"Status changed to Resolved"}]}],v=[{id:"rs-1",order:1,title:"Verify alert",description:"Confirm the alert is not a fluke. Check Grafana for error rate sustained above threshold.",command:null,completed:!0,critical:!1},{id:"rs-2",order:2,title:"Acknowledge & page team",description:"Acknowledge in PagerDuty. Page secondary on-call if needed.",command:null,completed:!0,critical:!1},{id:"rs-3",order:3,title:"Check pod health",description:"Check kubernetes pod status and recent events for auth-service.",command:`kubectl get pods -n production -l app=auth-service
kubectl describe pod <pod-name> -n production`,completed:!0,critical:!0},{id:"rs-4",order:4,title:"Check memory/CPU",description:"Inspect resource utilization. OOMkill is common cause of auth degradation.",command:"kubectl top pods -n production -l app=auth-service",completed:!0,critical:!0},{id:"rs-5",order:5,title:"Rolling restart",description:"If OOMkill detected, initiate rolling restart. Traffic will drain gracefully.",command:"kubectl rollout restart deployment/auth-service -n production",completed:!1,critical:!0},{id:"rs-6",order:6,title:"Verify recovery",description:"Watch error rate return to baseline (<1%) for at least 5 minutes.",command:null,completed:!1,critical:!1},{id:"rs-7",order:7,title:"Increase memory limit",description:"If this is a recurring issue, file a ticket to increase auth-service memory limit.",command:null,completed:!1,critical:!1}],j=[{label:"Summary",content:"Auth service experienced memory exhaustion on two pods, causing 5xx errors for 23% of authentication requests affecting ~18,000 users for approximately 45 minutes."},{label:"Root Cause",content:"Memory leak introduced in v2.14.1 (shipped 2026-02-20). The token validation cache had an unbounded growth pattern under high request volume."},{label:"Impact",content:"18,240 users unable to log in or refresh tokens. ~45 minutes of degraded authentication. No data loss."},{label:"Detection",content:"Automated alert fired after error rate exceeded 20% for 3 minutes. Detection was timely."},{label:"Resolution",content:"Rolling restart of affected pods. Memory leak fix deployed as v2.14.2 hotfix."},{label:"Action Items",content:"1. Add memory limit alert at 85% (not 95%). 2. Review token cache TTL configuration. 3. Add memory leak detection to CI pipeline. 4. Update runbook with OOM diagnosis steps."}];function y(){const[r,h]=o.useState("active"),[s,b]=o.useState(l[0]),[a,g]=o.useState(v),d=l.filter(t=>t.status!=="resolved"),c=s.startedAt?Math.floor((Date.now()-new Date(s.startedAt).getTime())/6e4):null;return e.jsxs("div",{className:"flex flex-col h-full bg-zinc-950 text-white",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-zinc-800 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Incident Command Center"}),e.jsx("p",{className:"text-sm text-zinc-400 mt-0.5",children:"Response Â· Runbooks Â· Postmortems"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-rose-400 animate-pulse"}),e.jsxs("span",{className:"text-rose-300 font-medium",children:[d.filter(t=>t.severity==="sev1").length," SEV1"]})]}),e.jsxs("span",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-orange-400"}),e.jsxs("span",{className:"text-orange-300 font-medium",children:[d.filter(t=>t.severity==="sev2").length," SEV2"]})]}),e.jsx("button",{className:"px-3 py-1.5 bg-rose-600 hover:bg-rose-500 rounded text-sm font-medium transition-colors",children:"+ Declare Incident"})]})]}),e.jsx("div",{className:"flex border-b border-zinc-800 px-6",children:["active","runbook","timeline","postmortem"].map(t=>e.jsx("button",{onClick:()=>h(t),className:i("px-4 py-3 text-sm font-medium border-b-2 transition-colors capitalize",r===t?"border-indigo-500 text-white":"border-transparent text-zinc-400 hover:text-zinc-200"),children:t==="postmortem"?"Postmortem":t.charAt(0).toUpperCase()+t.slice(1)},t))}),r==="active"&&e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx("div",{className:"w-80 border-r border-zinc-800 overflow-y-auto",children:l.map(t=>e.jsxs("button",{onClick:()=>b(t),className:i("w-full text-left px-4 py-3 border-b border-zinc-800/60 hover:bg-zinc-800/40 transition-colors",s.id===t.id&&"bg-zinc-800/60"),children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:i("text-xs font-bold font-mono",m[t.severity]),children:t.id}),e.jsx("span",{className:i("text-xs px-1.5 py-0.5 rounded-full ml-auto",x[t.severity]),children:t.severity.toUpperCase()})]}),e.jsx("div",{className:"text-xs font-medium text-white mb-1 leading-snug",children:t.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:i("text-xs px-1.5 py-0.5 rounded-full",u[t.status]),children:t.status}),e.jsx("span",{className:"text-xs text-zinc-500",children:t.service})]})]},t.id))}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("span",{className:i("font-bold font-mono",m[s.severity]),children:s.id}),e.jsx("span",{className:i("text-xs px-2 py-0.5 rounded-full font-medium",x[s.severity]),children:f[s.severity]}),e.jsx("span",{className:i("text-xs px-2 py-0.5 rounded-full",u[s.status]),children:s.status})]}),e.jsx("h2",{className:"text-base font-semibold",children:s.title})]}),s.status!=="resolved"&&e.jsx("button",{className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 rounded text-sm font-medium transition-colors",children:"Update Status"})]}),e.jsxs("div",{className:"bg-zinc-900 rounded-lg p-4 mb-4 border-l-2 border-rose-500",children:[e.jsx("div",{className:"text-xs font-medium text-zinc-400 mb-1.5",children:"Impact"}),e.jsx("p",{className:"text-sm text-zinc-300",children:s.impactDescription})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-zinc-900 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold font-mono text-rose-400",children:s.affectedUsers.toLocaleString()}),e.jsx("div",{className:"text-xs text-zinc-500",children:"affected users"})]}),e.jsxs("div",{className:"bg-zinc-900 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold font-mono text-white",children:s.durationMin!==null?`${s.durationMin}m`:c!==null?`${c}m`:"â€”"}),e.jsx("div",{className:"text-xs text-zinc-500",children:s.resolvedAt?"duration":"open for"})]}),e.jsxs("div",{className:"bg-zinc-900 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold font-mono text-white",children:s.responders.length}),e.jsx("div",{className:"text-xs text-zinc-500",children:"responders"})]}),e.jsxs("div",{className:"bg-zinc-900 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold font-mono text-white",children:s.timeline.length}),e.jsx("div",{className:"text-xs text-zinc-500",children:"timeline events"})]})]}),e.jsxs("div",{className:"bg-zinc-900 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"text-sm font-medium text-zinc-300 mb-3",children:"Responders"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.responders.map(t=>e.jsxs("div",{className:"flex items-center gap-2 bg-zinc-800 rounded-full px-3 py-1.5",children:[e.jsx("span",{className:i("w-2 h-2 rounded-full",t.active?"bg-emerald-400":"bg-zinc-600")}),e.jsx("span",{className:"text-xs font-medium text-white",children:t.name}),e.jsx("span",{className:"text-xs text-zinc-500",children:t.role}),e.jsxs("span",{className:"text-xs text-zinc-600",children:["since ",t.joinedAt]})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-zinc-300 mb-3",children:"Recent Activity"}),e.jsx("div",{className:"space-y-2",children:s.timeline.slice(-4).reverse().map(t=>e.jsxs("div",{className:"flex items-start gap-3 py-2 border-b border-zinc-800/40 last:border-0",children:[e.jsx("span",{className:"text-base mt-0.5",children:p[t.type]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-0.5",children:[e.jsx("span",{className:"text-xs font-medium text-white",children:t.author}),e.jsx("span",{className:"text-xs text-zinc-500",children:t.timestamp})]}),e.jsx("p",{className:"text-xs text-zinc-400 leading-snug",children:t.content}),t.metadata&&e.jsx("div",{className:"text-xs font-mono text-zinc-600 mt-0.5",children:t.metadata})]})]},t.id))})]})]})]}),r==="runbook"&&e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-semibold",children:"Auth Service Degraded â€” Runbook"}),e.jsxs("p",{className:"text-sm text-zinc-400 mt-0.5",children:[a.filter(t=>t.completed).length," of ",a.length," steps complete"]})]}),e.jsx("div",{className:"w-48 bg-zinc-800 rounded-full h-2",children:e.jsx("div",{className:"bg-indigo-500 h-2 rounded-full transition-all",style:{width:`${a.filter(t=>t.completed).length/a.length*100}%`}})})]}),e.jsx("div",{className:"space-y-3",children:a.map(t=>e.jsx("div",{className:i("bg-zinc-900 rounded-lg p-4 border-l-2 transition-all",t.completed?"border-emerald-500 opacity-70":t.critical?"border-rose-500":"border-zinc-700"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:()=>g(a.map(n=>n.id===t.id?{...n,completed:!n.completed}:n)),className:i("w-5 h-5 rounded border-2 flex-shrink-0 mt-0.5 flex items-center justify-center transition-colors",t.completed?"bg-emerald-500 border-emerald-500":"border-zinc-600 hover:border-zinc-400"),children:t.completed&&e.jsx("span",{className:"text-white text-xs font-bold",children:"âœ“"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsxs("span",{className:"text-xs text-zinc-500 font-mono",children:["Step ",t.order]}),e.jsx("span",{className:"text-sm font-medium text-white",children:t.title}),t.critical&&e.jsx("span",{className:"text-xs text-rose-400 bg-rose-500/10 px-1.5 py-0.5 rounded",children:"critical"})]}),e.jsx("p",{className:"text-xs text-zinc-400 mb-2",children:t.description}),t.command&&e.jsx("pre",{className:"bg-zinc-800 rounded p-2 text-xs font-mono text-zinc-300 overflow-x-auto",children:t.command})]})]})},t.id))})]}),r==="timeline"&&e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("h2",{className:"text-base font-semibold mb-4",children:["Full Timeline â€” ",s.id]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-5 top-0 bottom-0 w-px bg-zinc-800"}),e.jsx("div",{className:"space-y-4",children:s.timeline.map(t=>e.jsxs("div",{className:"relative flex items-start gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-zinc-900 border border-zinc-700 flex items-center justify-center flex-shrink-0 z-10 text-base",children:p[t.type]}),e.jsxs("div",{className:"flex-1 bg-zinc-900 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-1",children:[e.jsx("span",{className:"text-xs font-medium text-white",children:t.author}),e.jsx("span",{className:"text-xs font-mono text-zinc-500",children:t.timestamp}),e.jsx("span",{className:"text-xs text-zinc-600 capitalize",children:t.type.replace("_"," ")})]}),e.jsx("p",{className:"text-sm text-zinc-300",children:t.content}),t.metadata&&e.jsx("div",{className:"text-xs font-mono text-zinc-600 mt-1",children:t.metadata})]})]},t.id))})]})]}),r==="postmortem"&&e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-base font-semibold",children:["Postmortem Draft â€” ",s.id]}),e.jsx("p",{className:"text-sm text-zinc-400 mt-0.5",children:"Blameless postmortem in progress"})]}),e.jsx("button",{className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 rounded text-sm font-medium transition-colors",children:"Publish"})]}),e.jsx("div",{className:"space-y-4",children:j.map(t=>e.jsxs("div",{className:"bg-zinc-900 rounded-lg p-4",children:[e.jsx("div",{className:"text-xs font-semibold text-zinc-400 uppercase tracking-wide mb-2",children:t.label}),e.jsx("p",{className:"text-sm text-zinc-300 leading-relaxed",children:t.content})]},t.label))})]})]})}export{y as default};
