import{r as c,j as e,c as d}from"./index-De6mJXHu.js";const H=()=>Array.from({length:30},(n,i)=>Math.round(220+Math.sin(i*.4)*80+Math.random()*60)),D=["orchestrator","planner","executor","memory-store","embedder","retriever","tool-router","monitor"],w=()=>D.map((n,i)=>{const x=Math.round(64+Math.random()*192),m=Math.round(x*(.35+Math.random()*.62)),u=Math.round(m*(.15+Math.random()*.15)),b=Math.round(m*(.4+Math.random()*.2)),h=Math.round(m*(.1+Math.random()*.1)),g=m-u-b-h;return{pid:4200+i*13,name:n,rss:Math.round(x*(1.1+Math.random()*.4)),heapUsed:m,heapTotal:x,external:Math.round(8+Math.random()*32),status:["running","idle","gc"][Math.floor(Math.random()*3)],heap:{newSpace:u,oldSpace:b,codeSpace:h,mapSpace:g}}}),I=[[{name:"processMessage",width:100,memClass:"alloc"}],[{name:"parsePayload",width:62,memClass:"alloc"},{name:"validateSchema",width:38,memClass:"cache"}],[{name:"tokenize",width:40,memClass:"retain"},{name:"buildAST",width:22,memClass:"alloc"},{name:"allocBuffer",width:38,memClass:"mapped"}],[{name:"encodeChunk",width:25,memClass:"shared"},{name:"hashBlock",width:15,memClass:"retain"},{name:"lookupCache",width:22,memClass:"cache"},{name:"writeOut",width:38,memClass:"mapped"}],[{name:"flushStream",width:18,memClass:"shared"},{name:"gcMark",width:12,memClass:"retain"},{name:"serialize",width:15,memClass:"cache"},{name:"compress",width:25,memClass:"alloc"},{name:"emitEvent",width:30,memClass:"mapped"}]],M={alloc:"bg-indigo-500",retain:"bg-violet-500",cache:"bg-cyan-500",mapped:"bg-amber-500",shared:"bg-emerald-500"},L=()=>Array.from({length:5},(n,i)=>({timestamp:Date.now()-(5-i)*12e3+Math.round(Math.random()*4e3),durationMs:Math.round(4+Math.random()*28),reclaimed:Math.round(6+Math.random()*48)})),l=n=>`${n} MB`,y=n=>{const i=new Date(n);return`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}:${i.getSeconds().toString().padStart(2,"0")}`},p=n=>n.heapTotal>0?Math.round(n.heapUsed/n.heapTotal*100):0;function G(){const[n]=c.useState(H),[i,x]=c.useState(w),[m]=c.useState(L),[u,b]=c.useState(null),[h,g]=c.useState(null),[j,C]=c.useState("rss"),[f,T]=c.useState([]),[E,P]=c.useState(1),[v,z]=c.useState(null),A=Math.max(...n,1),$=[...i].sort((s,t)=>j==="name"?s.name.localeCompare(t.name):t[j]-s[j]),S=i.filter(s=>p(s)>=80),U=()=>{const s=i.reduce((t,a)=>t+a.rss,0);T(t=>[...t,{id:E,timestamp:Date.now(),totalRss:s,processCount:i.length}]),P(t=>t+1),x(w())},R=m.map(s=>{const t=Date.now(),a=30*6e3,r=t-s.timestamp,o=Math.max(0,Math.min(100,100-r/a*100));return{...s,pct:o}});return e.jsxs("div",{className:"min-h-screen bg-zinc-950 text-white p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Memory Profiler"}),e.jsx("p",{className:"text-sm text-zinc-400 mt-1",children:"Agent runtime memory analysis"})]}),e.jsx("button",{onClick:U,className:"px-4 py-2 rounded-lg bg-indigo-500 hover:bg-indigo-400 text-sm font-medium transition-colors",children:"Take Snapshot"})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-xl p-5",children:[e.jsx("h2",{className:"text-sm font-medium text-zinc-300 mb-3",children:"Memory Timeline"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex items-end gap-[3px] h-36",children:n.map((s,t)=>e.jsxs("div",{className:"relative flex-1 group",onMouseEnter:()=>g(t),onMouseLeave:()=>g(null),children:[e.jsx("div",{className:d("w-full rounded-t transition-colors",h===t?"bg-indigo-400":"bg-indigo-500/70"),style:{height:`${s/A*100}%`}}),h===t&&e.jsx("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 bg-zinc-800 text-xs px-2 py-1 rounded whitespace-nowrap z-10 border border-zinc-700",children:l(s)})]},t))}),e.jsx("div",{className:"relative h-3 mt-1",children:R.map((s,t)=>e.jsx("div",{className:"absolute top-0 h-3 w-1.5 rounded-sm bg-rose-500/80",style:{left:`${s.pct}%`},title:`GC ${s.durationMs}ms — reclaimed ${s.reclaimed} MB`},t))}),e.jsxs("div",{className:"flex justify-between text-[10px] text-zinc-500 mt-1",children:[e.jsx("span",{children:"-3 min"}),e.jsx("span",{children:"GC events (rose markers)"}),e.jsx("span",{children:"now"})]})]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-xl p-5",children:[e.jsx("h2",{className:"text-sm font-medium text-zinc-300 mb-3",children:"Recent GC Events"}),e.jsx("div",{className:"flex gap-3",children:m.map((s,t)=>e.jsxs("div",{className:"flex-1 bg-zinc-800 rounded-lg p-3 text-xs space-y-1 border border-zinc-700/50",children:[e.jsx("div",{className:"text-zinc-400",children:y(s.timestamp)}),e.jsxs("div",{className:"text-white font-medium",children:[s.durationMs,"ms"]}),e.jsxs("div",{className:"text-emerald-400",children:["-",s.reclaimed," MB"]}),e.jsx("div",{className:"h-1 bg-zinc-700 rounded-full mt-1",children:e.jsx("div",{className:"h-1 bg-rose-500 rounded-full",style:{width:`${Math.min(100,s.durationMs/32*100)}%`}})})]},t))})]}),S.length>0&&e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-xl p-5",children:[e.jsx("h2",{className:"text-sm font-medium text-zinc-300 mb-3",children:"Heap Alerts"}),e.jsx("div",{className:"space-y-2",children:S.sort((s,t)=>p(t)-p(s)).map(s=>{const t=p(s),a=t>=95;return e.jsxs("div",{className:d("flex items-center justify-between rounded-lg px-4 py-2 text-sm border",a?"bg-rose-500/10 border-rose-500/30 text-rose-300":"bg-amber-500/10 border-amber-500/30 text-amber-300"),children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("span",{children:[t,"% heap — ",l(s.heapUsed)," / ",l(s.heapTotal)]}),e.jsx("span",{className:d("text-xs px-2 py-0.5 rounded-full font-medium",a?"bg-rose-500/20":"bg-amber-500/20"),children:a?"CRITICAL":"WARNING"})]},s.pid)})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-zinc-400",children:"Sort by:"}),["rss","heapUsed","name"].map(s=>e.jsx("button",{onClick:()=>C(s),className:d("px-3 py-1.5 rounded-lg border text-xs font-medium transition-colors",j===s?"bg-indigo-500/20 border-indigo-500/50 text-indigo-300":"bg-zinc-900 border-zinc-800 text-zinc-400 hover:text-zinc-200"),children:s==="heapUsed"?"Heap Used":s==="rss"?"RSS":"Name"},s))]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-xl overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-7 gap-2 px-5 py-3 text-xs text-zinc-500 font-medium border-b border-zinc-800",children:[e.jsx("span",{children:"PID"}),e.jsx("span",{children:"Process"}),e.jsx("span",{children:"RSS"}),e.jsx("span",{children:"Heap Used"}),e.jsx("span",{children:"Heap Total"}),e.jsx("span",{children:"External"}),e.jsx("span",{children:"Status"})]}),$.map(s=>{const t=p(s),a=u===s.pid;return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>b(a?null:s.pid),className:d("w-full grid grid-cols-7 gap-2 px-5 py-3 text-sm text-left transition-colors hover:bg-zinc-800/60",a&&"bg-zinc-800/40"),children:[e.jsx("span",{className:"text-zinc-400 font-mono",children:s.pid}),e.jsx("span",{className:"text-white font-medium",children:s.name}),e.jsx("span",{children:l(s.rss)}),e.jsx("span",{className:d(t>=95?"text-rose-400":t>=80?"text-amber-400":"text-zinc-200"),children:l(s.heapUsed)}),e.jsx("span",{className:"text-zinc-300",children:l(s.heapTotal)}),e.jsx("span",{className:"text-zinc-400",children:l(s.external)}),e.jsx("span",{className:d("text-xs px-2 py-0.5 rounded-full w-fit font-medium",s.status==="running"?"bg-emerald-500/15 text-emerald-400":s.status==="gc"?"bg-rose-500/15 text-rose-400":"bg-zinc-700/40 text-zinc-400"),children:s.status})]}),a&&e.jsxs("div",{className:"px-5 pb-4 pt-1 space-y-3 border-b border-zinc-800/60",children:[e.jsx("h3",{className:"text-xs font-medium text-zinc-400",children:"Heap Breakdown"}),["newSpace","oldSpace","codeSpace","mapSpace"].map(r=>{const o=s.heap[r],N=s.heapUsed>0?o/s.heapUsed*100:0,B={newSpace:"bg-indigo-500",oldSpace:"bg-violet-500",codeSpace:"bg-cyan-500",mapSpace:"bg-amber-500"};return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{className:"text-zinc-300",children:r.replace(/([A-Z])/g," $1").trim()}),e.jsxs("span",{className:"text-zinc-500",children:[l(o)," (",Math.round(N),"%)"]})]}),e.jsx("div",{className:"h-2 bg-zinc-800 rounded-full overflow-hidden",children:e.jsx("div",{className:d("h-2 rounded-full transition-all",B[r]),style:{width:`${N}%`}})})]},r)}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-zinc-500 mb-1",children:"Combined"}),e.jsx("div",{className:"h-4 bg-zinc-800 rounded-full overflow-hidden flex",children:["newSpace","oldSpace","codeSpace","mapSpace"].map(r=>{const o=s.heapUsed>0?s.heap[r]/s.heapUsed*100:0,N={newSpace:"bg-indigo-500",oldSpace:"bg-violet-500",codeSpace:"bg-cyan-500",mapSpace:"bg-amber-500"};return e.jsx("div",{className:d("h-4",N[r]),style:{width:`${o}%`}},r)})})]})]})]},s.pid)})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-xl p-5",children:[e.jsx("h2",{className:"text-sm font-medium text-zinc-300 mb-1",children:"Memory Flamegraph"}),e.jsx("p",{className:"text-xs text-zinc-500 mb-4",children:"Top allocation paths by retained size"}),e.jsx("div",{className:"space-y-1",children:I.map((s,t)=>e.jsx("div",{className:"flex gap-0.5 h-9",children:s.map(a=>e.jsxs("div",{onMouseEnter:()=>z(a.name),onMouseLeave:()=>z(null),className:d("relative rounded-sm flex items-center justify-center text-[11px] font-medium transition-opacity cursor-default",M[a.memClass],v&&v!==a.name?"opacity-40":"opacity-90"),style:{width:`${a.width}%`},children:[e.jsx("span",{className:"truncate px-1 text-white/90",children:a.name}),v===a.name&&e.jsxs("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 bg-zinc-800 text-xs px-2 py-1 rounded whitespace-nowrap z-10 border border-zinc-700",children:[a.name," — ",a.memClass]})]},a.name))},t))}),e.jsx("div",{className:"flex gap-4 mt-4",children:Object.entries(M).map(([s,t])=>e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-zinc-400",children:[e.jsx("div",{className:d("w-2.5 h-2.5 rounded-sm",t)}),s]},s))})]}),f.length>0&&e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-xl p-5",children:[e.jsxs("h2",{className:"text-sm font-medium text-zinc-300 mb-3",children:["Snapshot History (",f.length,")"]}),e.jsx("div",{className:"space-y-2",children:f.map(s=>e.jsxs("div",{className:"flex items-center justify-between bg-zinc-800/50 rounded-lg px-4 py-2.5 text-sm border border-zinc-700/40",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-indigo-400 font-mono text-xs",children:["#",s.id]}),e.jsx("span",{className:"text-zinc-300",children:y(s.timestamp)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-zinc-400",children:[e.jsxs("span",{children:[s.processCount," processes"]}),e.jsxs("span",{className:"text-white font-medium",children:[l(s.totalRss)," total RSS"]})]})]},s.id))})]})]})}export{G as default};
