import{r as l,j as e,c as a}from"./index-CYvdMGBM.js";const r=[{id:"q-001",queryHash:"a3f91bc7",query:"SELECT u.*, o.total, o.created_at FROM users u LEFT JOIN orders o ON u.id = o.user_id WHERE u.plan = $1 AND o.created_at > $2 ORDER BY o.total DESC LIMIT 100",database:"app_prod",avgDurationMs:8420,maxDurationMs:23100,executions:1247,rowsExamined:42e5,rowsReturned:100,status:"slow",lastSeen:"2026-02-22T12:01:00Z",user:"app_user",plan:{node:"Limit",cost:142e3,rows:100,width:312,actual:8420,children:[{node:"Sort (total DESC)",cost:142e3,rows:18240,width:312,actual:8100,children:[{node:"Hash Left Join (u.id = o.user_id)",cost:98200,rows:18240,width:312,actual:7800,children:[{node:"Seq Scan users (plan=$1)",cost:12400,rows:24300,width:180,actual:2100},{node:"Hash Seq Scan orders (created_at>$2)",cost:64800,rows:182e4,width:64,actual:5600}]}]}]}},{id:"q-002",queryHash:"b7d44e21",query:"SELECT COUNT(*) FROM events WHERE user_id = $1 AND type IN ($2, $3, $4) AND created_at BETWEEN $5 AND $6",database:"analytics_prod",avgDurationMs:3240,maxDurationMs:9800,executions:8921,rowsExamined:21e5,rowsReturned:1,status:"slow",lastSeen:"2026-02-22T12:03:00Z",user:"analytics_reader",plan:{node:"Aggregate",cost:89e3,rows:1,width:8,actual:3240,children:[{node:"Bitmap Heap Scan events",cost:89e3,rows:42e4,width:0,actual:3100,children:[{node:"Bitmap Index Scan (idx_events_user_id)",cost:8200,rows:42e4,width:0,actual:420}]}]}},{id:"q-003",queryHash:"c2a88f59",query:"UPDATE sessions SET last_active = NOW(), metadata = $1 WHERE id = $2 AND expires_at > NOW()",database:"app_prod",avgDurationMs:12,maxDurationMs:48,executions:284020,rowsExamined:1,rowsReturned:1,indexUsed:"sessions_pkey",status:"fast",lastSeen:"2026-02-22T12:05:00Z",user:"app_user",plan:{node:"Update sessions",cost:8,rows:1,width:0,actual:12,children:[{node:"Index Scan (sessions_pkey, id=$2)",cost:4,rows:1,width:128,actual:1}]}},{id:"q-004",queryHash:"d9c16a30",query:"SELECT p.*, array_agg(t.name) AS tags FROM products p LEFT JOIN product_tags pt ON p.id = pt.product_id LEFT JOIN tags t ON pt.tag_id = t.id GROUP BY p.id HAVING COUNT(pt.id) > 0",database:"catalog_prod",avgDurationMs:5810,maxDurationMs:14200,executions:423,rowsExamined:89e4,rowsReturned:8420,status:"slow",lastSeen:"2026-02-22T11:55:00Z",user:"catalog_api",plan:{node:"HashAggregate (GROUP BY p.id)",cost:72400,rows:8420,width:420,actual:5810,children:[{node:"Hash Left Join (p.id = pt.product_id)",cost:61200,rows:89e4,width:224,actual:5200,children:[{node:"Seq Scan products",cost:4200,rows:94e3,width:180,actual:380},{node:"Hash Left Join (pt.tag_id = t.id)",cost:38400,rows:89e4,width:44,actual:4600,children:[{node:"Seq Scan product_tags",cost:18200,rows:89e4,width:16,actual:2100},{node:"Hash Seq Scan tags",cost:480,rows:240,width:28,actual:12}]}]}]}},{id:"q-005",queryHash:"e5f72c84",query:"SELECT * FROM audit_logs WHERE actor_id = $1 ORDER BY created_at DESC LIMIT 50",database:"app_prod",avgDurationMs:1820,maxDurationMs:4100,executions:3284,rowsExamined:124e5,rowsReturned:50,status:"slow",lastSeen:"2026-02-22T11:48:00Z",user:"admin_api",plan:{node:"Limit",cost:39e4,rows:50,width:312,actual:1820,children:[{node:"Sort (created_at DESC)",cost:39e4,rows:124e5,width:312,actual:1810,children:[{node:"Seq Scan audit_logs (actor_id=$1)",cost:28e4,rows:124e5,width:312,actual:1200}]}]}}],f=[{id:"idx-001",table:"orders",database:"app_prod",columns:["created_at","user_id"],type:"btree",estimatedSpeedup:"92%",affectedQueries:8,status:"missing",createStatement:"CREATE INDEX CONCURRENTLY idx_orders_created_at_user_id ON orders (created_at, user_id);"},{id:"idx-002",table:"events",database:"analytics_prod",columns:["user_id","type","created_at"],type:"btree",estimatedSpeedup:"84%",affectedQueries:12,status:"missing",createStatement:"CREATE INDEX CONCURRENTLY idx_events_user_type_created ON events (user_id, type, created_at);"},{id:"idx-003",table:"audit_logs",database:"app_prod",columns:["actor_id","created_at"],type:"btree",estimatedSpeedup:"96%",affectedQueries:3,status:"missing",createStatement:"CREATE INDEX CONCURRENTLY idx_audit_logs_actor_created ON audit_logs (actor_id, created_at DESC);"},{id:"idx-004",table:"sessions",database:"app_prod",columns:["user_id"],type:"btree",estimatedSpeedup:"â€”",affectedQueries:0,status:"unused",createStatement:"-- Already exists: DROP INDEX IF EXISTS idx_sessions_user_id;"},{id:"idx-005",table:"product_tags",database:"catalog_prod",columns:["product_id","tag_id"],type:"btree",estimatedSpeedup:"71%",affectedQueries:4,status:"missing",createStatement:"CREATE INDEX CONCURRENTLY idx_product_tags_product_tag ON product_tags (product_id, tag_id);"}],N=[{name:"app_prod",activeConnections:48,maxConnections:100,cacheHitRate:96.8,txPerSec:842,avgQueryTimeMs:24,slowQueryCount:18},{name:"analytics_prod",activeConnections:12,maxConnections:50,cacheHitRate:89.2,txPerSec:124,avgQueryTimeMs:180,slowQueryCount:7},{name:"catalog_prod",activeConnections:8,maxConnections:50,cacheHitRate:94.1,txPerSec:42,avgQueryTimeMs:65,slowQueryCount:3},{name:"billing_prod",activeConnections:5,maxConnections:30,cacheHitRate:98.4,txPerSec:18,avgQueryTimeMs:12,slowQueryCount:1}],E={slow:"text-rose-400 bg-rose-400/10",normal:"text-amber-400 bg-amber-400/10",fast:"text-emerald-400 bg-emerald-400/10",error:"text-rose-600 bg-rose-600/10"},C={missing:"text-rose-400 bg-rose-400/10",unused:"text-amber-400 bg-amber-400/10",redundant:"text-amber-400 bg-amber-400/10",used:"text-emerald-400 bg-emerald-400/10"};function o(t){return t<1e3?`${t}ms`:`${(t/1e3).toFixed(1)}s`}function u(t){return t>=1e6?`${(t/1e6).toFixed(1)}M`:t>=1e3?`${(t/1e3).toFixed(1)}K`:t.toString()}function w({node:t,depth:d=0}){var c,x;const[i,p]=l.useState(d<2);return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>p(n=>!n),className:"flex items-start gap-2 w-full text-left hover:bg-zinc-800/50 rounded px-2 py-1 transition-colors",style:{paddingLeft:`${8+d*16}px`},children:[e.jsx("span",{className:"text-zinc-600 shrink-0 mt-0.5 text-xs",children:(c=t.children)!=null&&c.length?i?"â–¾":"â–¸":"Â·"}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-xs font-mono text-zinc-200",children:t.node}),e.jsxs("span",{className:"text-xs text-zinc-500",children:["cost=",t.cost.toLocaleString()]}),e.jsxs("span",{className:"text-xs text-zinc-500",children:["rows=",t.rows.toLocaleString()]}),t.actual!==void 0&&e.jsxs("span",{className:a("text-xs font-mono",t.actual>1e3?"text-rose-400":t.actual>100?"text-amber-400":"text-emerald-400"),children:["actual=",o(t.actual)]})]})})]}),i&&((x=t.children)==null?void 0:x.map((n,h)=>e.jsx(w,{node:n,depth:d+1},h)))]})}function D(){const[t,d]=l.useState("queries"),[i,p]=l.useState(null),[c,x]=l.useState("all"),[n,h]=l.useState("all"),[g,v]=l.useState(null),y=[{id:"queries",label:"Slow Queries",emoji:"ðŸ¢"},{id:"indexes",label:"Index Analysis",emoji:"âš¡"},{id:"databases",label:"Database Health",emoji:"ðŸ—„"},{id:"explain",label:"EXPLAIN Viewer",emoji:"ðŸ”¬"}],j=r.filter(s=>!(c!=="all"&&s.status!==c||n!=="all"&&s.database!==n));i&&r.find(s=>s.id===i);const b=g?r.find(s=>s.id===g):null,z=r.filter(s=>s.status==="slow").length,_=f.filter(s=>s.status==="missing").length,S=Math.round(r.reduce((s,m)=>s+m.avgDurationMs,0)/r.length);return e.jsxs("div",{className:"min-h-screen bg-zinc-950 text-white p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Query Performance Analyzer"}),e.jsx("p",{className:"text-zinc-400 text-sm mt-1",children:"Identify slow queries, missing indexes, and optimization opportunities"})]}),e.jsx("button",{className:"px-4 py-2 bg-zinc-800 hover:bg-zinc-700 rounded-md text-sm text-zinc-300 transition-colors",children:"Export Report"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-zinc-900 border border-rose-400/20 rounded-lg p-4",children:[e.jsx("div",{className:"text-xs text-zinc-400 mb-1",children:"Slow Queries"}),e.jsx("div",{className:"text-2xl font-bold text-rose-400",children:z}),e.jsxs("div",{className:"text-xs text-zinc-500 mt-1",children:["avg ",o(S)]})]}),e.jsxs("div",{className:"bg-zinc-900 border border-amber-400/20 rounded-lg p-4",children:[e.jsx("div",{className:"text-xs text-zinc-400 mb-1",children:"Missing Indexes"}),e.jsx("div",{className:"text-2xl font-bold text-amber-400",children:_}),e.jsx("div",{className:"text-xs text-zinc-500 mt-1",children:"potential 80%+ improvement"})]}),e.jsxs("div",{className:"bg-zinc-900 border border-zinc-700 rounded-lg p-4",children:[e.jsx("div",{className:"text-xs text-zinc-400 mb-1",children:"Databases Monitored"}),e.jsx("div",{className:"text-2xl font-bold text-zinc-300",children:N.length}),e.jsx("div",{className:"text-xs text-zinc-500 mt-1",children:"all healthy"})]}),e.jsxs("div",{className:"bg-zinc-900 border border-emerald-400/20 rounded-lg p-4",children:[e.jsx("div",{className:"text-xs text-zinc-400 mb-1",children:"Cache Hit Rate"}),e.jsx("div",{className:"text-2xl font-bold text-emerald-400",children:"94.6%"}),e.jsx("div",{className:"text-xs text-zinc-500 mt-1",children:"avg across databases"})]})]}),e.jsx("div",{className:"flex gap-1 mb-6 border-b border-zinc-800",children:y.map(s=>e.jsxs("button",{onClick:()=>d(s.id),className:a("px-4 py-2.5 text-sm font-medium rounded-t-md border-b-2 transition-colors",t===s.id?"border-indigo-500 text-white bg-zinc-900":"border-transparent text-zinc-400 hover:text-zinc-300"),children:[s.emoji," ",s.label]},s.id))}),t==="queries"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:c,onChange:s=>x(s.target.value),className:"bg-zinc-800 border border-zinc-700 rounded-md px-3 py-1.5 text-sm text-white",children:[e.jsx("option",{value:"all",children:"All Statuses"}),e.jsx("option",{value:"slow",children:"Slow"}),e.jsx("option",{value:"fast",children:"Fast"}),e.jsx("option",{value:"error",children:"Error"})]}),e.jsxs("select",{value:n,onChange:s=>h(s.target.value),className:"bg-zinc-800 border border-zinc-700 rounded-md px-3 py-1.5 text-sm text-white",children:[e.jsx("option",{value:"all",children:"All Databases"}),N.map(s=>e.jsx("option",{value:s.name,children:s.name},s.name))]}),e.jsxs("span",{className:"text-sm text-zinc-400 self-center",children:[j.length," queries"]})]}),e.jsx("div",{className:"space-y-2",children:j.map(s=>e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg overflow-hidden",children:[e.jsx("button",{onClick:()=>p(i===s.id?null:s.id),className:"w-full text-left p-4 hover:bg-zinc-800/50 transition-colors",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[e.jsx("span",{className:a("text-xs px-2 py-0.5 rounded-full font-medium",E[s.status]),children:s.status}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-zinc-800 text-zinc-400 rounded",children:s.database}),e.jsx("span",{className:"text-xs font-mono text-zinc-500",children:s.queryHash})]}),e.jsx("code",{className:"text-xs text-indigo-300 font-mono line-clamp-2 block",children:s.query})]}),e.jsxs("div",{className:"flex items-center gap-4 shrink-0 text-sm",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-zinc-500 mb-0.5",children:"Avg"}),e.jsx("div",{className:a("font-mono",s.avgDurationMs>5e3?"text-rose-400":s.avgDurationMs>1e3?"text-amber-400":"text-emerald-400"),children:o(s.avgDurationMs)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-zinc-500 mb-0.5",children:"Executions"}),e.jsx("div",{className:"text-zinc-300",children:u(s.executions)})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-xs text-zinc-500 mb-0.5",children:"Rows Scanned"}),e.jsx("div",{className:"text-zinc-300",children:u(s.rowsExamined)})]}),e.jsx("span",{className:"text-zinc-600",children:i===s.id?"â–²":"â–¼"})]})]})}),i===s.id&&e.jsxs("div",{className:"border-t border-zinc-800 p-4 bg-zinc-950 space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"bg-zinc-900 rounded-md p-3",children:[e.jsx("div",{className:"text-xs text-zinc-500 mb-1",children:"Max Duration"}),e.jsx("div",{className:"text-rose-400 font-mono",children:o(s.maxDurationMs)})]}),e.jsxs("div",{className:"bg-zinc-900 rounded-md p-3",children:[e.jsx("div",{className:"text-xs text-zinc-500 mb-1",children:"Rows Returned / Examined"}),e.jsxs("div",{className:"text-zinc-300 font-mono",children:[u(s.rowsReturned)," / ",u(s.rowsExamined)]})]}),e.jsxs("div",{className:"bg-zinc-900 rounded-md p-3",children:[e.jsx("div",{className:"text-xs text-zinc-500 mb-1",children:"User / Last Seen"}),e.jsx("div",{className:"text-zinc-300",children:s.user})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{v(s.id),d("explain")},className:"px-3 py-1.5 text-xs bg-indigo-500/10 text-indigo-400 hover:bg-indigo-500/20 rounded-md transition-colors",children:"ðŸ”¬ View EXPLAIN Plan"}),e.jsx("button",{className:"px-3 py-1.5 text-xs bg-zinc-800 text-zinc-400 hover:bg-zinc-700 rounded-md transition-colors",children:"Copy Query"})]})]})]},s.id))})]}),t==="indexes"&&e.jsx("div",{className:"space-y-3",children:f.map(s=>e.jsx("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:a("text-xs px-2 py-0.5 rounded-full font-medium",C[s.status]),children:s.status}),e.jsxs("span",{className:"font-medium text-sm",children:[s.database,".",s.table]}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-zinc-800 text-zinc-400 rounded",children:s.type})]}),e.jsxs("div",{className:"flex items-center gap-1 mb-2",children:[e.jsx("span",{className:"text-xs text-zinc-500",children:"Columns:"}),s.columns.map(m=>e.jsx("span",{className:"text-xs font-mono px-1.5 py-0.5 bg-zinc-800 text-indigo-300 rounded",children:m},m))]}),e.jsx("code",{className:"text-xs font-mono text-zinc-400 bg-zinc-800 px-3 py-2 rounded-md block",children:s.createStatement})]}),e.jsxs("div",{className:"text-right shrink-0",children:[e.jsx("div",{className:a("text-2xl font-bold",s.status==="missing"?"text-emerald-400":"text-zinc-400"),children:s.estimatedSpeedup}),e.jsx("div",{className:"text-xs text-zinc-500",children:"speedup"}),e.jsxs("div",{className:"text-xs text-zinc-400 mt-1",children:[s.affectedQueries," queries"]}),s.status==="missing"&&e.jsx("button",{className:"mt-2 px-3 py-1 text-xs bg-indigo-500/10 text-indigo-400 hover:bg-indigo-500/20 rounded-md transition-colors",children:"Create Index"}),s.status==="unused"&&e.jsx("button",{className:"mt-2 px-3 py-1 text-xs bg-rose-400/10 text-rose-400 hover:bg-rose-400/20 rounded-md transition-colors",children:"Drop Index"})]})]})},s.id))}),t==="databases"&&e.jsx("div",{className:"space-y-4",children:N.map(s=>e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium font-mono",children:s.name}),e.jsxs("div",{className:"text-sm text-zinc-400 mt-0.5",children:[s.slowQueryCount," slow queries active"]})]}),e.jsx("div",{className:a("text-sm font-medium",s.slowQueryCount>10?"text-rose-400":s.slowQueryCount>5?"text-amber-400":"text-emerald-400"),children:s.slowQueryCount>10?"âš  Degraded":s.slowQueryCount>5?"! Watch":"âœ“ Healthy"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500 mb-1",children:"Connections"}),e.jsxs("div",{className:"text-zinc-300",children:[s.activeConnections,"/",s.maxConnections]}),e.jsx("div",{className:"mt-1 w-full h-1.5 bg-zinc-800 rounded-full overflow-hidden",children:e.jsx("div",{className:a("h-full rounded-full",s.activeConnections/s.maxConnections>.8?"bg-rose-500":"bg-indigo-500"),style:{width:`${s.activeConnections/s.maxConnections*100}%`}})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500 mb-1",children:"Cache Hit Rate"}),e.jsxs("div",{className:a("font-mono",s.cacheHitRate>95?"text-emerald-400":s.cacheHitRate>90?"text-amber-400":"text-rose-400"),children:[s.cacheHitRate,"%"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500 mb-1",children:"Transactions/s"}),e.jsx("div",{className:"text-zinc-300",children:s.txPerSec})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-zinc-500 mb-1",children:"Avg Query Time"}),e.jsx("div",{className:a("font-mono",s.avgQueryTimeMs>100?"text-amber-400":"text-emerald-400"),children:o(s.avgQueryTimeMs)})]})]})]},s.name))}),t==="explain"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex gap-2 flex-wrap",children:r.map(s=>e.jsx("button",{onClick:()=>v(s.id),className:a("px-3 py-1.5 text-xs rounded-md font-mono transition-colors",g===s.id?"bg-indigo-500 text-white":"bg-zinc-800 text-zinc-400 hover:bg-zinc-700"),children:s.queryHash},s.id))}),b?e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-zinc-800",children:e.jsx("code",{className:"text-xs font-mono text-indigo-300 line-clamp-2",children:b.query})}),e.jsx("div",{className:"p-3 space-y-0.5",children:e.jsx(w,{node:b.plan})}),e.jsxs("div",{className:"p-3 border-t border-zinc-800 flex items-center gap-4 text-xs text-zinc-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded bg-emerald-500 inline-block"})," <100ms"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded bg-amber-500 inline-block"})," 100msâ€“1s"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded bg-rose-500 inline-block"})," >1s"]})]})]}):e.jsx("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-12 text-center text-zinc-500",children:"Select a query hash to view its EXPLAIN plan"})]})]})}export{D as default};
