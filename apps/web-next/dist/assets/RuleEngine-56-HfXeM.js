import{r as c,j as e,c as l}from"./index-thh1EXOZ.js";const j=["routing","escalation","rate-limit","access","notification"],u={routing:"bg-indigo-500/20 text-indigo-400 border-indigo-500/30",escalation:"bg-rose-500/20 text-rose-400 border-rose-500/30","rate-limit":"bg-amber-500/20 text-amber-400 border-amber-500/30",access:"bg-emerald-500/20 text-emerald-400 border-emerald-500/30",notification:"bg-sky-500/20 text-sky-400 border-sky-500/30"},H={"==":"equals","!=":"not equals",">":"greater than","<":"less than",">=":"at least","<=":"at most",contains:"contains",not_contains:"not contains",in:"in",not_in:"not in"},A=[{id:"r1",name:"Route High Cost",description:"Routes expensive token requests to the budget-friendly model to control spend.",category:"routing",priority:8,enabled:!0,conditions:[{field:"cost_per_token",operator:">",value:"0.01"}],action:"route to budget model",matchCount:1842,lastMatched:"2026-02-22T01:12:00Z",matchHistory:[240,310,275,198,260,320,239]},{id:"r2",name:"Escalate Critical",description:"Pages the on-call engineer when critical errors persist after multiple retries.",category:"escalation",priority:10,enabled:!0,conditions:[{field:"error_severity",operator:"==",value:"critical"},{field:"retry_count",operator:">",value:"3"}],action:"page on-call",matchCount:47,lastMatched:"2026-02-21T22:45:00Z",matchHistory:[5,8,3,12,7,6,6]},{id:"r3",name:"Rate Limit Burst",description:"Throttles clients exceeding 100 requests per minute to protect service stability.",category:"rate-limit",priority:9,enabled:!0,conditions:[{field:"requests_per_min",operator:">",value:"100"}],action:"throttle",matchCount:3291,lastMatched:"2026-02-22T02:30:00Z",matchHistory:[420,510,480,390,475,520,496]},{id:"r4",name:"Block Unauthorized",description:"Rejects any request missing a valid authentication token.",category:"access",priority:10,enabled:!0,conditions:[{field:"auth_token",operator:"==",value:"null"}],action:"reject",matchCount:892,lastMatched:"2026-02-22T02:10:00Z",matchHistory:[110,135,128,140,125,130,124]},{id:"r5",name:"Notify on Success",description:"Sends a summary notification when long-running tasks complete successfully.",category:"notification",priority:5,enabled:!0,conditions:[{field:"task_status",operator:"==",value:"completed"},{field:"task_duration",operator:">",value:"300"}],action:"send summary",matchCount:614,lastMatched:"2026-02-22T00:55:00Z",matchHistory:[78,95,82,90,88,92,89]},{id:"r6",name:"Route EU Traffic",description:"Ensures EU-originating requests are handled by EU-region endpoints for GDPR compliance.",category:"routing",priority:7,enabled:!0,conditions:[{field:"region",operator:"in",value:"eu-west-1,eu-central-1"},{field:"data_class",operator:"==",value:"personal"}],action:"route to EU endpoint",matchCount:2105,lastMatched:"2026-02-22T02:25:00Z",matchHistory:[280,305,290,310,295,315,310]},{id:"r7",name:"Escalate Latency Spike",description:"Alerts the platform team when p99 latency exceeds 5 seconds.",category:"escalation",priority:8,enabled:!1,conditions:[{field:"p99_latency_ms",operator:">",value:"5000"}],action:"alert platform team",matchCount:23,lastMatched:"2026-02-19T14:20:00Z",matchHistory:[0,2,8,5,4,3,1]},{id:"r8",name:"Block Deprecated API",description:"Rejects calls to deprecated v1 API endpoints, forcing migration to v2.",category:"access",priority:6,enabled:!0,conditions:[{field:"api_version",operator:"==",value:"v1"},{field:"endpoint",operator:"contains",value:"/legacy"}],action:"reject with 410",matchCount:156,lastMatched:"2026-02-21T18:00:00Z",matchHistory:[30,25,22,20,24,18,17]},{id:"r9",name:"Rate Limit New Accounts",description:"Applies stricter rate limits to accounts created within the last 24 hours.",category:"rate-limit",priority:7,enabled:!0,conditions:[{field:"account_age_hours",operator:"<",value:"24"},{field:"requests_per_min",operator:">",value:"30"}],action:"throttle to 30 rpm",matchCount:437,lastMatched:"2026-02-22T01:50:00Z",matchHistory:[55,68,60,72,58,65,59]},{id:"r10",name:"Notify Quota Warning",description:"Warns account owners when their usage reaches 80% of their allocated quota.",category:"notification",priority:4,enabled:!0,conditions:[{field:"quota_usage_pct",operator:">=",value:"80"},{field:"notification_sent",operator:"==",value:"false"}],action:"send quota warning email",matchCount:289,lastMatched:"2026-02-21T20:30:00Z",matchHistory:[35,42,38,45,40,48,41]}];function N(s){return s>=9?"text-rose-400 bg-rose-500/15":s>=7?"text-amber-400 bg-amber-500/15":s>=4?"text-indigo-400 bg-indigo-500/15":"text-zinc-400 bg-zinc-700/40"}function L(s,m){const a=m[s.field],o=s.value;return s.operator==="=="?String(a??"null")===o:s.operator==="!="?String(a??"null")!==o:s.operator===">"?Number(a)>Number(o):s.operator==="<"?Number(a)<Number(o):s.operator===">="?Number(a)>=Number(o):s.operator==="<="?Number(a)<=Number(o):s.operator==="contains"?String(a).includes(o):s.operator==="not_contains"?!String(a).includes(o):s.operator==="in"?o.split(",").includes(String(a)):s.operator==="not_in"?!o.split(",").includes(String(a)):!1}function P(){var v;const[s,m]=c.useState(A),[a,o]=c.useState(null),[d,h]=c.useState(null),[x,z]=c.useState(!1),[g,w]=c.useState(`{
  "cost_per_token": 0.02
}`),[b,p]=c.useState(null),f=d?s.filter(t=>t.category===d):s,n=s.find(t=>t.id===a)??null,C=s.filter(t=>t.enabled).length,S=s.reduce((t,i)=>t+i.matchHistory.reduce((r,M)=>r+M,0),0),_=((v=j.map(t=>({c:t,n:s.filter(i=>i.category===t).length})).sort((t,i)=>i.n-t.n)[0])==null?void 0:v.c)??"routing",y=t=>{m(i=>i.map(r=>r.id===t?{...r,enabled:!r.enabled}:r))},k=t=>{m(i=>i.filter(r=>r.id!==t)),a===t&&o(null)},T=()=>{if(n)try{const t=JSON.parse(g),i=new Map;n.conditions.forEach(r=>{i.set(`${r.field} ${r.operator} ${r.value}`,L(r,t))}),p(i)}catch{p(null)}},R=n?Math.max(...n.matchHistory,1):1,E=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];return e.jsxs("div",{className:"min-h-screen bg-zinc-950 text-white p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Rule Engine"}),e.jsx("button",{className:"bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 rounded text-sm font-medium",children:"+ New Rule"})]}),e.jsxs("div",{className:"flex gap-2 mb-5 flex-wrap",children:[e.jsx("button",{onClick:()=>h(null),className:l("px-3 py-1 rounded-full text-xs font-medium border transition-colors",d===null?"bg-indigo-600 border-indigo-500 text-white":"bg-zinc-900 border-zinc-700 text-zinc-400 hover:border-zinc-600"),children:"All"}),j.map(t=>e.jsx("button",{onClick:()=>h(d===t?null:t),className:l("px-3 py-1 rounded-full text-xs font-medium border transition-colors capitalize",d===t?u[t]:"bg-zinc-900 border-zinc-700 text-zinc-400 hover:border-zinc-600"),children:t},t))]}),e.jsx("div",{className:"grid grid-cols-4 gap-3 mb-5",children:[{label:"Total Rules",value:String(s.length)},{label:"Active",value:String(C)},{label:"Top Category",value:_},{label:"Matches (7d)",value:S.toLocaleString()}].map(t=>e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg px-4 py-3",children:[e.jsx("div",{className:"text-zinc-500 text-xs mb-1",children:t.label}),e.jsx("div",{className:"text-lg font-semibold capitalize",children:t.value})]},t.label))}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"w-[55%] space-y-2 max-h-[calc(100vh-280px)] overflow-y-auto pr-1",children:[f.map(t=>e.jsxs("button",{onClick:()=>{o(t.id),p(null)},className:l("w-full text-left bg-zinc-900 border rounded-lg px-4 py-3 transition-colors",a===t.id?"border-indigo-500 ring-1 ring-indigo-500/30":"border-zinc-800 hover:border-zinc-700"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium text-sm",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:l("text-xs px-2 py-0.5 rounded-full border capitalize",u[t.category]),children:t.category}),e.jsxs("span",{className:l("text-xs px-2 py-0.5 rounded font-mono",N(t.priority)),children:["P",t.priority]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:[t.conditions.slice(0,2).map((i,r)=>e.jsxs("span",{className:"text-xs bg-zinc-800 border border-zinc-700 text-zinc-300 px-2 py-0.5 rounded",children:[i.field," ",i.operator," ",i.value]},r)),t.conditions.length>2&&e.jsxs("span",{className:"text-xs text-zinc-500",children:["+",t.conditions.length-2," more"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs text-zinc-500",children:["→ ",t.action]}),e.jsxs("span",{className:"text-xs text-zinc-500",children:[t.matchCount.toLocaleString()," matches"]})]}),e.jsx("div",{role:"switch","aria-checked":t.enabled,onClick:i=>{i.stopPropagation(),y(t.id)},className:l("w-8 h-4 rounded-full relative cursor-pointer transition-colors",t.enabled?"bg-emerald-500":"bg-zinc-700"),children:e.jsx("div",{className:l("absolute top-0.5 w-3 h-3 rounded-full bg-white transition-transform",t.enabled?"translate-x-4":"translate-x-0.5")})})]})]},t.id)),f.length===0&&e.jsx("div",{className:"text-zinc-500 text-sm text-center py-12",children:"No rules match this filter."})]}),e.jsx("div",{className:"w-[45%] max-h-[calc(100vh-280px)] overflow-y-auto",children:n?e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-5 space-y-5",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h2",{className:"text-lg font-semibold",children:n.name}),e.jsx("span",{className:l("text-xs px-2 py-0.5 rounded-full border capitalize",u[n.category]),children:n.category})]}),e.jsx("p",{className:"text-sm text-zinc-400",children:n.description})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-2",children:"Conditions"}),e.jsxs("div",{className:"border border-zinc-800 rounded overflow-hidden",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-px bg-zinc-800 text-xs font-medium text-zinc-500",children:[e.jsx("div",{className:"bg-zinc-900 px-3 py-2",children:"Field"}),e.jsx("div",{className:"bg-zinc-900 px-3 py-2",children:"Operator"}),e.jsx("div",{className:"bg-zinc-900 px-3 py-2",children:"Value"})]}),n.conditions.map((t,i)=>e.jsxs("div",{className:"grid grid-cols-3 gap-px bg-zinc-800 text-sm",children:[e.jsx("div",{className:"bg-zinc-900 px-3 py-2 font-mono text-indigo-400",children:t.field}),e.jsx("div",{className:"bg-zinc-900 px-3 py-2 text-zinc-300",children:H[t.operator]}),e.jsx("div",{className:"bg-zinc-900 px-3 py-2 font-mono text-amber-400",children:t.value})]},i))]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-2",children:"Action"}),e.jsxs("div",{className:"flex items-center gap-2 bg-zinc-800 border border-zinc-700 rounded px-3 py-2 text-sm",children:[e.jsx("span",{className:"text-zinc-500",children:"→"}),e.jsx("span",{className:"text-emerald-400 font-medium",children:n.action})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-semibold text-zinc-500 uppercase tracking-wider mb-2",children:"Match History (7 days)"}),e.jsx("div",{className:"flex items-end gap-1.5 h-24 bg-zinc-800 border border-zinc-700 rounded p-3",children:n.matchHistory.map((t,i)=>e.jsxs("div",{className:"flex-1 flex flex-col items-center gap-1 h-full justify-end",children:[e.jsx("span",{className:"text-[10px] text-zinc-500",children:t}),e.jsx("div",{className:"w-full bg-indigo-500 rounded-sm min-h-[2px] transition-all",style:{height:`${t/R*100}%`}}),e.jsx("span",{className:"text-[10px] text-zinc-600",children:E[i]})]},i))})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:l("px-2 py-0.5 rounded font-mono text-xs",N(n.priority)),children:["Priority ",n.priority]}),e.jsxs("span",{className:"text-zinc-500",children:[n.matchCount.toLocaleString()," total matches"]}),e.jsxs("span",{className:"text-zinc-600 text-xs",children:["Last: ",new Date(n.lastMatched).toLocaleString()]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[e.jsx("button",{onClick:()=>y(n.id),className:l("px-3 py-1.5 rounded text-sm font-medium",n.enabled?"bg-zinc-800 border border-zinc-700 text-zinc-300 hover:bg-zinc-700":"bg-emerald-600 hover:bg-emerald-500 text-white"),children:n.enabled?"Disable":"Enable"}),e.jsx("button",{className:"bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 rounded text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>k(n.id),className:"bg-rose-600/20 hover:bg-rose-600/30 text-rose-400 border border-rose-500/30 px-3 py-1.5 rounded text-sm",children:"Delete"})]}),e.jsxs("div",{className:"border-t border-zinc-800 pt-4",children:[e.jsxs("button",{onClick:()=>z(!x),className:"flex items-center gap-2 text-sm font-medium text-zinc-400 hover:text-white transition-colors",children:[e.jsx("span",{className:l("inline-block transition-transform text-xs",x&&"rotate-90"),children:"▶"}),"Rule Tester"]}),x&&e.jsxs("div",{className:"mt-3 space-y-3",children:[e.jsx("textarea",{value:g,onChange:t=>w(t.target.value),rows:5,className:"w-full bg-zinc-800 border border-zinc-700 text-white rounded px-3 py-2 text-sm font-mono resize-y",placeholder:'{"field": "value"}'}),e.jsx("button",{onClick:T,className:"bg-indigo-600 hover:bg-indigo-500 text-white px-3 py-1.5 rounded text-sm font-medium",children:"Test Rule"}),b&&e.jsx("div",{className:"space-y-1.5",children:Array.from(b.entries()).map(([t,i])=>e.jsxs("div",{className:l("flex items-center gap-2 text-sm px-3 py-1.5 rounded border",i?"bg-emerald-500/10 border-emerald-500/20 text-emerald-400":"bg-rose-500/10 border-rose-500/20 text-rose-400"),children:[e.jsx("span",{className:"font-bold",children:i?"✓":"✗"}),e.jsx("span",{className:"font-mono text-xs",children:t})]},t))})]})]})]}):e.jsxs("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-12 text-center",children:[e.jsx("div",{className:"text-zinc-600 text-3xl mb-3",children:"⚙"}),e.jsx("div",{className:"text-zinc-500 text-sm",children:"Select a rule to view details"})]})})]})]})}export{P as default};
