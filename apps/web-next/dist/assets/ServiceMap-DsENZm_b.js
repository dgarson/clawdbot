import{r as m,j as e,c as o}from"./index-DVeYZYUu.js";const p={healthy:{dot:"bg-emerald-400",label:"Healthy",badge:"bg-emerald-400/10 text-emerald-400 ring-emerald-400/20"},degraded:{dot:"bg-amber-400",label:"Degraded",badge:"bg-amber-400/10 text-amber-400 ring-amber-400/20"},down:{dot:"bg-rose-400",label:"Down",badge:"bg-rose-400/10 text-rose-400 ring-rose-400/20"},unknown:{dot:"bg-zinc-500",label:"Unknown",badge:"bg-zinc-500/10 text-zinc-400 ring-zinc-500/20"}},b={gateway:{label:"Gateway",color:"bg-indigo-500/10 text-indigo-400 ring-indigo-500/20"},api:{label:"API",color:"bg-sky-500/10 text-sky-400 ring-sky-500/20"},worker:{label:"Worker",color:"bg-violet-500/10 text-violet-400 ring-violet-500/20"},database:{label:"Database",color:"bg-orange-500/10 text-orange-400 ring-orange-500/20"},cache:{label:"Cache",color:"bg-teal-500/10 text-teal-400 ring-teal-500/20"},queue:{label:"Queue",color:"bg-pink-500/10 text-pink-400 ring-pink-500/20"},external:{label:"External",color:"bg-zinc-500/10 text-zinc-300 ring-zinc-500/20"}},h=["gateway","api","worker","database","cache","queue","external"],S=[{value:"all",label:"All"},{value:"healthy",label:"Healthy"},{value:"degraded",label:"Degraded"},{value:"down",label:"Down"}];function R(t){return t>=1e3?`${(t/1e3).toFixed(1)}s`:`${t}ms`}function j(t){return`${t.toFixed(1)}%`}function v(t){return t>=1e3?`${(t/1e3).toFixed(1)}k`:String(t)}function y(t,a){return a===0?`${t} (embedded)`:t.includes(".")?t:`${t}:${a}`}function O(t){let a=1;for(const i of t)i.metrics.p99>a&&(a=i.metrics.p99);return a}const l=[{id:"openclaw-gateway",name:"OpenClaw Gateway",kind:"gateway",status:"healthy",version:"v1.14.2",uptime:"14d 6h",host:"0.0.0.0",port:8080,metrics:{p50:8,p95:42,p99:180,errorRate:.2,rps:148},dependsOn:["agent-runner","file-server"],description:"Edge gateway handling all inbound traffic. Routes requests to internal services, manages TLS termination, rate limiting, and auth token validation."},{id:"agent-runner",name:"Agent Runner",kind:"worker",status:"healthy",version:"v2.3.1",uptime:"14d 6h",host:"0.0.0.0",port:8081,metrics:{p50:240,p95:1800,p99:4200,errorRate:1.1,rps:28},dependsOn:["model-proxy","redis-cache","sqlite-db"],description:"Orchestrates agent execution loops. Manages tool invocation, context assembly, and streaming responses back to the gateway."},{id:"model-proxy",name:"Model Proxy",kind:"api",status:"degraded",version:"v1.8.0",uptime:"6d 18h",host:"0.0.0.0",port:8082,metrics:{p50:620,p95:3800,p99:8100,errorRate:4.8,rps:56},dependsOn:["anthropic-api","openai-api","gemini-api"],description:"Unified LLM gateway abstracting provider differences. Currently degraded due to elevated error rates from the OpenAI upstream."},{id:"file-server",name:"File Server",kind:"api",status:"healthy",version:"v1.2.0",uptime:"14d 6h",host:"0.0.0.0",port:8083,metrics:{p50:12,p95:85,p99:280,errorRate:.1,rps:42},dependsOn:["s3-storage"],description:"Handles file uploads, downloads, and workspace file operations. Streams large files directly from S3."},{id:"redis-cache",name:"Redis Cache",kind:"cache",status:"healthy",version:"v7.2.4",uptime:"30d 2h",host:"0.0.0.0",port:6379,metrics:{p50:1,p95:4,p99:12,errorRate:0,rps:2840},dependsOn:[],description:"In-memory cache for session state, rate-limit counters, and hot-path data. Persistence disabled — ephemeral by design."},{id:"sqlite-db",name:"SQLite DB",kind:"database",status:"healthy",version:"v3.45.0",uptime:"14d 6h",host:"embedded",port:0,metrics:{p50:2,p95:8,p99:28,errorRate:0,rps:440},dependsOn:[],description:"Embedded relational store for agent memory, conversation history, and configuration. WAL mode enabled for concurrent reads."},{id:"anthropic-api",name:"Anthropic API",kind:"external",status:"healthy",version:"—",uptime:"—",host:"api.anthropic.com",port:443,metrics:{p50:880,p95:2400,p99:4800,errorRate:.8,rps:18},dependsOn:[],description:"External provider for Claude model family. Primary model backend with the highest reliability among LLM providers."},{id:"openai-api",name:"OpenAI API",kind:"external",status:"degraded",version:"—",uptime:"—",host:"api.openai.com",port:443,metrics:{p50:1200,p95:7500,p99:12e3,errorRate:8.4,rps:6},dependsOn:[],description:"External provider for GPT model family. Currently rate-limited — elevated p95/p99 and 8.4% error rate. Fallback routing active."},{id:"gemini-api",name:"Gemini API",kind:"external",status:"healthy",version:"—",uptime:"—",host:"generativelanguage.googleapis.com",port:443,metrics:{p50:420,p95:1800,p99:3200,errorRate:.4,rps:14},dependsOn:[],description:"External provider for Gemini model family. Used as secondary backend and for embedding generation."},{id:"s3-storage",name:"S3 Storage",kind:"external",status:"healthy",version:"—",uptime:"—",host:"s3.amazonaws.com",port:443,metrics:{p50:88,p95:320,p99:680,errorRate:.1,rps:12},dependsOn:[],description:"AWS S3 object storage for workspace files, uploaded assets, and agent artifacts. Regional bucket with versioning enabled."}];function A({metrics:t,maxMs:a}){const i=[{value:t.p50,color:"bg-indigo-500"},{value:t.p95,color:"bg-indigo-400"},{value:t.p99,color:"bg-indigo-300"}];return e.jsx("div",{className:"flex items-end gap-px h-5 w-8","aria-hidden":"true",children:i.map((s,d)=>{const c=a>0?Math.max(s.value/a*100,6):6;return e.jsx("div",{className:o("w-2 rounded-sm",s.color),style:{height:`${c}%`}},d)})})}function g({active:t,onClick:a,children:i,dot:s}){return e.jsxs("button",{type:"button",onClick:a,className:o("inline-flex items-center gap-1.5 rounded-full px-3 py-1 text-xs font-medium transition-colors",t?"bg-indigo-500/15 text-indigo-400 ring-1 ring-indigo-500/30":"bg-zinc-800 text-zinc-400 ring-1 ring-zinc-700 hover:bg-zinc-700 hover:text-zinc-200"),children:[s&&e.jsx("span",{className:o("inline-block h-1.5 w-1.5 rounded-full",s),"aria-hidden":"true"}),i]})}function u({kind:t}){const a=b[t];return e.jsx("span",{className:o("inline-flex items-center rounded-md px-1.5 py-0.5 text-[10px] font-semibold uppercase tracking-wide ring-1 ring-inset",a.color),children:a.label})}function C({status:t}){const a=p[t];return e.jsxs("span",{className:o("inline-flex items-center gap-1.5 rounded-full px-2.5 py-0.5 text-xs font-medium ring-1 ring-inset",a.badge),children:[e.jsx("span",{className:o("h-1.5 w-1.5 rounded-full",a.dot),"aria-hidden":"true"}),a.label]})}function L({metrics:t,maxMs:a}){const i=s=>a>0?Math.max(s/a*100,2):2;return e.jsx("div",{className:"space-y-2",children:[{label:"p50",value:t.p50,color:"bg-indigo-500"},{label:"p95",value:t.p95,color:"bg-indigo-400"},{label:"p99",value:t.p99,color:"bg-indigo-300"}].map(s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"w-7 shrink-0 text-[11px] font-mono text-zinc-500",children:s.label}),e.jsx("div",{className:"relative h-2 flex-1 rounded-full bg-zinc-800",children:e.jsx("div",{className:o("absolute inset-y-0 left-0 rounded-full",s.color),style:{width:`${i(s.value)}%`}})}),e.jsx("span",{className:"w-14 shrink-0 text-right text-xs font-mono text-zinc-300",children:R(s.value)})]},s.label))})}function E({service:t,selected:a,onSelect:i,maxMs:s}){const d=p[t.status];return e.jsxs("button",{type:"button",onClick:i,className:o("group flex w-full items-center gap-3 rounded-lg px-3 py-2.5 text-left transition-colors",a?"bg-zinc-800 ring-1 ring-indigo-500/40":"hover:bg-zinc-800/60"),children:[e.jsx("span",{className:o("h-2.5 w-2.5 shrink-0 rounded-full ring-2 ring-zinc-900",d.dot),"aria-label":d.label}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"truncate text-sm font-medium text-white",children:t.name}),e.jsx(u,{kind:t.kind})]}),e.jsxs("div",{className:"mt-0.5 flex items-center gap-2 text-[11px] text-zinc-500",children:[e.jsx("span",{className:"font-mono",children:y(t.host,t.port)}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:[v(t.metrics.rps)," rps"]}),t.metrics.errorRate>2&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"·"}),e.jsxs("span",{className:"text-rose-400",children:[j(t.metrics.errorRate)," err"]})]})]})]}),e.jsx(A,{metrics:t.metrics,maxMs:s})]})}function f({service:t,onClick:a}){const i=p[t.status];return e.jsxs("button",{type:"button",onClick:a,className:"flex items-center gap-2 rounded-md px-2 py-1.5 text-left text-sm transition-colors hover:bg-zinc-800",children:[e.jsx("span",{className:o("h-2 w-2 rounded-full",i.dot),"aria-hidden":"true"}),e.jsx("span",{className:"text-zinc-200",children:t.name}),e.jsx(u,{kind:t.kind})]})}function D({service:t,allServices:a,maxMs:i,onSelectService:s}){p[t.status];const d=t.dependsOn.map(r=>a.find(x=>x.id===r)).filter(r=>r!==void 0),c=a.filter(r=>r.dependsOn.includes(t.id));return e.jsxs("div",{className:"flex flex-col gap-4 overflow-y-auto",children:[e.jsx("div",{className:"rounded-xl bg-zinc-900 ring-1 ring-zinc-800 p-5",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:t.name}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-xs text-zinc-400",children:[e.jsx(u,{kind:t.kind}),e.jsx("span",{className:"font-mono",children:t.version}),e.jsx("span",{children:"·"}),e.jsx("span",{className:"font-mono",children:y(t.host,t.port)}),e.jsx("span",{children:"·"}),e.jsxs("span",{children:["up ",t.uptime]})]})]}),e.jsx(C,{status:t.status})]})}),e.jsxs("div",{className:"rounded-xl bg-zinc-900 ring-1 ring-zinc-800 p-5 space-y-4",children:[e.jsx("h3",{className:"text-xs font-semibold uppercase tracking-wider text-zinc-500",children:"Latency"}),e.jsx(L,{metrics:t.metrics,maxMs:i}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2",children:[e.jsxs("div",{className:"rounded-lg bg-zinc-800/60 p-3",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wider text-zinc-500",children:"Error Rate"}),e.jsx("p",{className:o("mt-1 text-xl font-semibold font-mono",t.metrics.errorRate>=5?"text-rose-400":t.metrics.errorRate>=2?"text-amber-400":"text-emerald-400"),children:j(t.metrics.errorRate)})]}),e.jsxs("div",{className:"rounded-lg bg-zinc-800/60 p-3",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wider text-zinc-500",children:"Throughput"}),e.jsxs("p",{className:"mt-1 text-xl font-semibold font-mono text-white",children:[v(t.metrics.rps)," ",e.jsx("span",{className:"text-xs text-zinc-500 font-normal",children:"rps"})]})]})]})]}),(d.length>0||c.length>0)&&e.jsxs("div",{className:"rounded-xl bg-zinc-900 ring-1 ring-zinc-800 p-5 space-y-4",children:[d.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[11px] font-semibold uppercase tracking-wider text-zinc-500 mb-2",children:["Depends On (",d.length,")"]}),e.jsx("div",{className:"flex flex-col gap-0.5",children:d.map(r=>e.jsx(f,{service:r,onClick:()=>s(r.id)},r.id))})]}),c.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-[11px] font-semibold uppercase tracking-wider text-zinc-500 mb-2",children:["Depended On By (",c.length,")"]}),e.jsx("div",{className:"flex flex-col gap-0.5",children:c.map(r=>e.jsx(f,{service:r,onClick:()=>s(r.id)},r.id))})]})]}),e.jsxs("div",{className:"rounded-xl bg-zinc-900 ring-1 ring-zinc-800 p-5",children:[e.jsx("h3",{className:"text-[11px] font-semibold uppercase tracking-wider text-zinc-500 mb-2",children:"Description"}),e.jsx("p",{className:"text-sm leading-relaxed text-zinc-300",children:t.description})]})]})}function M(){const[t,a]=m.useState("all"),[i,s]=m.useState("all"),[d,c]=m.useState(l[0].id),r=O(l),x=l.filter(n=>!(t!=="all"&&n.status!==t||i!=="all"&&n.kind!==i)),N=l.find(n=>n.id===d)??l[0],k={all:l.length,healthy:l.filter(n=>n.status==="healthy").length,degraded:l.filter(n=>n.status==="degraded").length,down:l.filter(n=>n.status==="down").length,unknown:l.filter(n=>n.status==="unknown").length},w=Array.from(new Set(l.map(n=>n.kind))).sort((n,z)=>h.indexOf(n)-h.indexOf(z));return e.jsxs("div",{className:"flex h-full flex-col gap-4 p-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-white",children:"Service Map"}),e.jsxs("p",{className:"mt-0.5 text-sm text-zinc-400",children:["Topology, health, and latency across ",l.length," services"]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[S.map(n=>e.jsxs(g,{active:t===n.value,onClick:()=>a(n.value),dot:n.value!=="all"?p[n.value].dot:void 0,children:[n.label,e.jsx("span",{className:"ml-0.5 text-zinc-500",children:k[n.value]})]},n.value)),e.jsx("span",{className:"mx-1 h-4 w-px bg-zinc-700","aria-hidden":"true"}),e.jsx(g,{active:i==="all",onClick:()=>s("all"),children:"All kinds"}),w.map(n=>e.jsx(g,{active:i===n,onClick:()=>s(n),children:b[n].label},n))]}),e.jsxs("div",{className:"grid min-h-0 flex-1 grid-cols-1 gap-4 lg:grid-cols-[minmax(320px,420px)_1fr]",children:[e.jsx("div",{className:"rounded-xl bg-zinc-900 ring-1 ring-zinc-800 p-2 overflow-y-auto",children:x.length===0?e.jsx("div",{className:"flex h-32 items-center justify-center text-sm text-zinc-500",children:"No services match the current filters."}):e.jsx("div",{className:"flex flex-col gap-0.5",children:x.map(n=>e.jsx(E,{service:n,selected:n.id===d,onSelect:()=>c(n.id),maxMs:r},n.id))})}),e.jsx(D,{service:N,allServices:l,maxMs:r,onSelectService:c})]})]})}export{M as default};
