# Web Parity Task Debug Workspace Filesystem Parity

## Task objective

Separate true production diagnostics from prototype mock pages, and wire workspace file browsing to real worktree RPC methods in active agent session workflows.

In scope:

1. Debug pages under `/debug`.
2. Session workspace pane file explorer and preview.
3. Filesystem route under `/filesystem`.

## Why this is critical for OpenClaw setup

Operators use debug and workspace views to diagnose and recover systems. Mock data in these paths creates misleading signals during incidents and onboarding.

## Current behavior and evidence

### Mixed parity under debug routes

- Live diagnostics exist:
  - Health and RPC and events and logs in `apps/web/src/routes/debug/index.tsx:296`, `apps/web/src/routes/debug/index.tsx:525`, `apps/web/src/routes/debug/index.tsx:639`, `apps/web/src/routes/debug/index.tsx:807`
- Terminal page is live gateway client:
  - `apps/web/src/routes/debug/terminal.lazy.tsx:74`
- Workbench route is mock:
  - `apps/web/src/routes/debug/workbench.tsx:33`
  - `apps/web/src/routes/debug/workbench.tsx:59`
- Graph route is synthetic demo data:
  - `apps/web/src/routes/debug/graph.lazy.tsx:32`

### Session workspace uses mock tree and partial file preview wiring

- Mock tree is rendered for explorer:
  - `apps/web/src/components/domain/session/SessionWorkspacePane.tsx:50`
  - `apps/web/src/components/domain/session/SessionWorkspacePane.tsx:285`
- File preview attempts live read via adapter but reports not implemented errors:
  - `apps/web/src/components/domain/session/SessionWorkspacePane.tsx:159`
  - `apps/web/src/components/domain/session/SessionWorkspacePane.tsx:174`

### Filesystem route is mock only

- Hardcoded fake filesystem content:
  - `apps/web/src/routes/filesystem/index.tsx:50`

## Existing backend capability already available

- Worktree RPC handlers are implemented in gateway:
  - `src/gateway/server-methods/worktree.ts:32`
- Web API wrappers and adapter already exist:
  - `apps/web/src/lib/api/worktree.ts:80`
  - `apps/web/src/integrations/worktree/gateway.ts:30`

## Implementation plan

### Step 1 classify debug surfaces by production readiness

1. Keep live debug tabs and terminal available.
2. Move synthetic pages (`/debug/workbench`, `/debug/graph`) behind explicit experimental flag or relocate to references.
3. Add clear badge text for prototype routes if retained.

Primary files:

- `apps/web/src/routes/debug/workbench.tsx`
- `apps/web/src/routes/debug/graph.lazy.tsx`
- `apps/web/src/routeTree.gen.ts` (generated by router build if route changes)

### Step 2 replace mock file tree in session workspace

Change `SessionWorkspacePane` to fetch directory entries using worktree adapter `list`.

Primary file:

- `apps/web/src/components/domain/session/SessionWorkspacePane.tsx`

Suggested data flow:

1. On mount or refresh, call `worktreeAdapter.list(agentId, "/")`.
2. Build tree structure from returned entries.
3. Keep `readFile` for preview using existing adapter.

### Step 3 improve error mapping for file preview

Current generic not implemented messages should be replaced with actionable reasons from gateway error shape.

Expected behavior:

1. `not_connected` style message when gateway disconnected.
2. `permission_denied`, `file_not_found`, `not_a_file` style user readable mapping.
3. Retry action preserving selected path.

### Step 4 rework `/filesystem` route

Choose one path:

1. Convert route to live worktree browser (preferred).
2. Or mark route as prototype and remove from primary navigation.

If converting to live:

- Reuse same worktree API adapter used by `SessionWorkspacePane`.
- Add agent selector so path is unambiguous.

## Code sample for live listing integration

```ts
const worktreeAdapter = React.useMemo(() => createWorktreeGatewayAdapter(), []);

const loadTree = React.useCallback(async () => {
  if (!agentId) return;
  const root = await worktreeAdapter.list(agentId, "/");
  setTreeEntries(root.entries);
}, [agentId, worktreeAdapter]);
```

## Testing plan

### Unit and integration

1. Add tests for tree builder from flat worktree entries.
2. Add tests for preview error mapping.

### Manual verification

1. Open agent session page, file tab.
2. Confirm real files appear from selected agent workspace.
3. Read a text file and verify content matches disk.
4. Rename or delete via adapter and verify refresh.

### Required test gates

1. `pnpm test:affected`
2. `pnpm test:smart`
3. `pnpm test`
4. `pnpm build && pnpm check`

## Acceptance criteria

1. Session workspace file list is live, not mock.
2. File preview uses real worktree read semantics with clear errors.
3. Debug pages clearly distinguish live diagnostic features from prototypes.
4. Filesystem route is either live and truthful or explicitly non production.

## Out of scope

1. Full IDE grade editor implementation.
2. Replacing terminal stack.

## Related docs and references

- Related task docs:
  - [Gateway Contract Parity](/web/parity/06-gateway-contract-parity-overseer-method-catalog)
- Existing OpenClaw docs:
  - [Configuration](/configuration)
  - [Gateway Doctor](/gateway/doctor)
